@model List<BudgetCal.Models.Item>

@{
    ViewData["Title"] = "Budget Calendar";
}

<div class="expense-tracker">
    <div class="layers-sidebar" id="layersSidebar">
        <div class="layers-header">
            <h3 class="layers-title">Layers</h3>
            <div class="layers-header-actions">
                <button id="addLayerBtn" class="btn-icon-small" title="Add Layer">+</button>
                <button id="toggleSidebarBtn" class="btn-icon-small" title="Collapse Sidebar">«</button>
            </div>
        </div>
        <div id="layersList" class="layers-list">
            <!-- Layers will be populated here -->
        </div>
    </div>
    <button id="expandSidebarBtn" class="expand-sidebar-btn" title="Expand Sidebar" style="display: none;">»</button>
    <div class="calendar-main">
        <div class="header">
            <div class="header-left-nav">
                <button id="prevMonth" class="nav-btn">&larr;</button>
                <h2 id="monthYear">@ViewBag.MonthName</h2>
                <button id="nextMonth" class="nav-btn">&rarr;</button>
            </div>
            <div class="header-right-nav">
                <div class="account-selector-container">
                    <select id="accountSelector" class="account-select">
                        @foreach (var account in ViewBag.Accounts as List<BudgetCal.Models.Account>)
                        {
                            <option value="@account.Id" selected="@(account.Id == ViewBag.AccountId)">@account.Name</option>
                        }
                    </select>
                    <button id="manageAccountsBtn" class="btn-icon-small" title="Manage Accounts">⚙️</button>
                </div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <div class="day-name">Sunday</div>
                <div class="day-name">Monday</div>
                <div class="day-name">Tuesday</div>
                <div class="day-name">Wednesday</div>
                <div class="day-name">Thursday</div>
                <div class="day-name">Friday</div>
                <div class="day-name">Saturday</div>
            </div>
            <div id="calendarGrid" class="calendar-grid"></div>
        </div>
    </div>
</div>

<!-- Item Modal -->
<div id="expenseModal" class="modal">
    <div class="modal-content budget-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <div class="modal-title-row">
                    <h3 id="modalTitle"></h3>
                    <div id="editModeIndicator" class="edit-mode-indicator" style="display: none;">Single Instance</div>
                </div>
                <div id="modalSubtitle" class="modal-subtitle">Scheduled for Dec 1, 2025</div>
            </div>
            <div class="header-right-new">
                <span class="close">&times;</span>
            </div>
        </div>

        <form id="expenseForm">
            <input type="hidden" id="expenseId" />
            <input type="hidden" id="isRecurringInstance" />

            <div class="form-row">
                <div class="form-group-new flex-2">
                    <label for="expenseDescription">Name:</label>
                    <input type="text" id="expenseDescription" class="underline-input" placeholder="e.g. Rent, Groceries" required />
                </div>
                <div class="form-group-new flex-1">
                    <label for="expenseAmount">Amount:</label>
                    <input type="number" id="expenseAmount" class="underline-input" step="0.01" placeholder="0.00" required />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group-new flex-1 type-group">
                    <label>Type:</label>
                    <select id="expenseType" class="underline-input">
                        <option value="Debit">Expense</option>
                        <option value="Credit">Income</option>
                    </select>
                </div>
                <div class="form-group-new flex-1">
                    <label>Layer:</label>
                    <select id="expenseLayer" class="underline-input">
                        <option value="">Default</option>
                        <!-- Layer options will be populated here -->
                    </select>
                </div>
                <div class="form-group-new flex-2">
                    <label for="expenseDate">Date:</label>
                    <input type="date" id="expenseDate" class="underline-input" required />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group-new flex-1">
                    <label>Repeat:</label>
                    <div class="recurring-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isRecurring" />
                            <span class="checkbox-custom"></span>
                        </label>
                        <div id="recurringOptionsInline" class="recurring-inline" style="display: none;">
                            <span>every</span>
                            <input type="number" id="recurringInterval" class="underline-input small-input" min="1" value="1" />
                            <select id="recurringPeriod" class="underline-input medium-input">
                                <option value="days">days</option>
                                <option value="weeks">weeks</option>
                                <option value="months">months</option>
                                <option value="years">years</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group-new flex-1">
                    <label>Color:</label>
                    <div class="color-picker-new">
                        <!-- Reds/Oranges -->
                        <div class="color-square" data-color="#f44336"></div>
                        <div class="color-square" data-color="#8d3d3d"></div>
                        <div class="color-square" data-color="#ff9800"></div>
                        <div class="color-square" data-color="#ffcc80"></div>
                        
                        <!-- Yellows/Greens -->
                        <div class="color-square" data-color="#ffeb3b"></div>
                        <div class="color-square" data-color="#4caf50"></div>
                        <div class="color-square" data-color="#00a884"></div>
                        
                        <!-- Blues/Purples -->
                        <div class="color-square" data-color="#00bcd4"></div>
                        <div class="color-square" data-color="#2196f3"></div>
                        <div class="color-square" data-color="#9c27b0"></div>
                        
                        <!-- Neutrals -->
                        <div class="color-square" data-color="#9e9e9e"></div>
                        <div class="color-square" data-color="#efebe9"></div>
                        <input type="hidden" id="expenseColor" value="#efebe9" />
                    </div>
                </div>
            </div>

            <div class="form-actions-new">
                <div></div>
                <div class="actions-right">
                    <button type="button" class="btn-text-secondary" id="cancelExpenseBtn">CANCEL</button>
                    <button type="button" id="deleteExpenseBtn" class="btn-text-danger" style="display:none;">DELETE</button>
                    <button type="submit" class="btn-save">SAVE</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Recurring Edit Mode Modal -->
<div id="recurringEditModal" class="modal">
    <div class="modal-content budget-modal small-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <h3>Edit Recurring Item</h3>
                <div class="modal-subtitle">How would you like to edit this series?</div>
            </div>
            <div class="header-right-new">
                <span class="close" id="closeRecurringEditModal">&times;</span>
            </div>
        </div>
        <div class="recurring-options-modern">
            <button type="button" id="editThisOne" class="btn-option">
                <span class="option-title">This Instance Only</span>
                <span class="option-desc">Only change this specific date</span>
            </button>
            <button type="button" id="editFromThisOne" class="btn-option">
                <span class="option-title">This and Future</span>
                <span class="option-desc">Apply changes from this date forward</span>
            </button>
            <button type="button" id="editAllInSeries" class="btn-option">
                <span class="option-title">All in Series</span>
                <span class="option-desc">Update every instance in the series</span>
            </button>
        </div>
        <div class="form-actions-new">
            <div></div>
            <div class="actions-right">
                <button type="button" class="btn-text-secondary" id="cancelRecurringEdit">CANCEL</button>
            </div>
        </div>
    </div>
</div>

<!-- Recurring Delete Mode Modal -->
<div id="recurringDeleteModal" class="modal">
    <div class="modal-content budget-modal small-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <h3>Delete Recurring Item</h3>
                <div class="modal-subtitle">How would you like to delete this series?</div>
            </div>
            <div class="header-right-new">
                <span class="close" id="closeRecurringDeleteModal">&times;</span>
            </div>
        </div>
        <div class="recurring-options-modern">
            <button type="button" id="deleteThisOne" class="btn-option danger">
                <span class="option-title">This Instance Only</span>
                <span class="option-desc">Only remove this specific date</span>
            </button>
            <button type="button" id="deleteFromThisOne" class="btn-option danger">
                <span class="option-title">This and Future</span>
                <span class="option-desc">Remove this and all upcoming dates</span>
            </button>
            <button type="button" id="deleteAllInSeries" class="btn-option danger">
                <span class="option-title">All in Series</span>
                <span class="option-desc">Remove the entire series</span>
            </button>
        </div>
        <div class="form-actions-new">
            <div></div>
            <div class="actions-right">
                <button type="button" class="btn-text-secondary" id="cancelRecurringDelete">CANCEL</button>
            </div>
        </div>
    </div>
</div>

<!-- Balance Override Modal -->
<div id="balanceModal" class="modal">
    <div class="modal-content budget-modal small-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <h3>Set Balance</h3>
                <div id="balanceDateSubtitle" class="modal-subtitle">Dec 1, 2025</div>
            </div>
            <div class="header-right-new">
                <span class="close" id="closeBalanceModal">&times;</span>
            </div>
        </div>
        <form id="balanceForm">
            <div class="form-row">
                <div class="form-group-new flex-1">
                    <label for="balanceAmount">Balance Amount:</label>
                    <input type="number" id="balanceAmount" class="underline-input" step="0.01" placeholder="0.00" required />
                </div>
            </div>
            <div class="form-actions-new">
                <div></div>
                <div class="actions-right">
                    <button type="button" class="btn-text-secondary" id="cancelBalanceBtn">CANCEL</button>
                    <button type="submit" class="btn-save">SET BALANCE</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Add Layer Modal -->
<div id="layerModal" class="modal">
    <div class="modal-content budget-modal small-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <h3>Add New Layer</h3>
                <div class="modal-subtitle">Create a conceptual grouping for items</div>
            </div>
            <div class="header-right-new">
                <span class="close" id="closeLayerModal">&times;</span>
            </div>
        </div>
        <form id="layerForm">
            <input type="hidden" id="editLayerId" />
            <div class="form-row">
                <div class="form-group-new flex-1">
                    <label for="layerName">Layer Name:</label>
                    <input type="text" id="layerName" class="underline-input" placeholder="e.g. Credit Card Payoff" required />
                </div>
            </div>
            <div class="form-actions-new">
                <div></div>
                <div class="actions-right">
                    <button type="button" class="btn-text-secondary" id="cancelLayerBtn">CANCEL</button>
                    <button type="submit" class="btn-save" id="saveLayerBtn">CREATE LAYER</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Account Management Modal -->
<div id="accountModal" class="modal">
    <div class="modal-content budget-modal">
        <div class="modal-header-new">
            <div class="header-left">
                <h3 id="accountModalTitle">Manage Accounts</h3>
                <div class="modal-subtitle">Add or edit your money accounts</div>
            </div>
            <div class="header-right-new">
                <span class="close" id="closeAccountModal">&times;</span>
            </div>
        </div>
        
        <div id="accountListContainer" class="account-list-container">
            <table class="account-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Start Date</th>
                        <th>Start Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="accountTableBody">
                    <!-- Accounts will be populated here -->
                </tbody>
            </table>
        </div>

        <div class="account-form-section">
            <h4 id="accountFormTitle">Add New Account</h4>
            <form id="accountForm">
                <input type="hidden" id="editAccountId" />
                <div class="form-row">
                    <div class="form-group-new flex-2">
                        <label for="accountName">Account Name:</label>
                        <input type="text" id="accountName" class="underline-input" placeholder="e.g. Savings, Checking" required />
                    </div>
                    <div class="form-group-new flex-1">
                        <label for="accountStartBalance">Starting Balance:</label>
                        <input type="number" id="accountStartBalance" class="underline-input" step="0.01" value="1000.00" required />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group-new flex-1">
                        <label for="accountStartDate">Starting Date:</label>
                        <input type="date" id="accountStartDate" class="underline-input" value="2025-09-01" required />
                    </div>
                    <div class="form-group-new flex-2">
                        <label for="accountDescription">Description:</label>
                        <input type="text" id="accountDescription" class="underline-input" placeholder="Optional description" />
                    </div>
                </div>
                <div class="form-actions-new">
                    <div class="actions-left">
                        <button type="button" class="btn-text-secondary" id="resetAccountForm" style="display: none;">CANCEL EDIT</button>
                    </div>
                    <div class="actions-right">
                        <button type="submit" class="btn-save" id="saveAccountBtn">CREATE ACCOUNT</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/expense-calendar.js"></script>
}
